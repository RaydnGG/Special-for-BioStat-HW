---
title: "Homework №4"
output: html_document
date: "2024-04-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# импорты
library(dplyr)
library(ggplot2)
library(tidyverse)
library(car)

```

## Задание 1

**Рассмотрите следующую статистическую гипотезу.**

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатом (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость.

```{r}
set.seed(55)
# размер выборки
sample_size <- 30

# давление до и после
mean_pressure_before <- 161
mean_pressure_after <- 128

# уровень значимости
alpha <-  0.05

# генерируем выборки
sd_pressure <- 16
pressure_before <- rnorm(sample_size, mean_pressure_before, sd_pressure)

sd_pressure_after <- 6
pressure_after <- rnorm(sample_size, mean_pressure_after, sd_pressure_after)

pressure_df <- data.frame(before = pressure_before, after = pressure_after)
pressure_df

```

Формулируем гипотезы:

H0 - препарат не имеет преимущества над стандартной терапией (нет стат значимости между выборкми)

H1 - препарат имеет преимущество над стандартной терапией (есть стат значимость между выборками)

Далее, чтобы определиться с выбором стат теста определим нормальное ли распределение у нас в выборках:

```{r}
# распределение значений давления до приема
ggplot(pressure_df, aes(x = before)) +
  geom_histogram(binwidth = 4,fill = "pink", color = "black") +
  labs(title = "Гистограмма распределения артериального давления до приема препарата", x = "Значения", y = "Частота") +
  theme_minimal()
# Хоть и слабо, но напоминает паттерн нормального распределения, проведем тест на нормальность и сделаем заключение
```

```{r}
# H0 - распределение в выборке не отличается от нормального
# H1 - распределение в выборке отлично от нормального
shapiro.test(pressure_df$before)
# p value = 0.8712 - отклоняем альтернативную гипотезу и принимаем нулевую => распределение нормальное
```

```{r}
# распределение значений давления после приема
ggplot(pressure_df, aes(x = after)) +
  geom_histogram(binwidth = 2,fill = "lightblue", color = "black") +
  labs(title = "Гистограмма распределения артериального давления после приема препарата", x = "Значения", y = "Частота") +
  theme_minimal()
# Похожая ситуация, вроде бы и паттерн схожий, но не то =) 
```

```{r}
# H0 - распределение в выборке не отличается от нормального
# H1 - распределение в выборке отлично от нормального
shapiro.test(pressure_df$after)
# p value 0.8153 - также принимаем нулевую
```

Итак на основе визуального анализа и результатов теста делаю заключение, что обе выборки имеют нормальное распределение.

Таким образом у нас:

-   выборки имеют нормальное распределение

-   выборки зависимые ( пациенты до и после приема препаратов)

    Исходя из этого мы можем использовать парный т-тест

```{r}
t.test(pressure_df$before,pressure_df$after, paired = TRUE)
crit <-  qt(1 - alpha/2, df = 29)
crit
```

t = 10.745, df = 29, p-value = 1.261e-11

Значение p value меньше уровня значимости 0.05, а значит мы принимаем альтернативную гипотезу

Критическое значение будет равно 2.04523 95% доверительный интервал: 28.22861 - 41.50118 Значение t статистики значительно превышает критическое значение: 10.745 \> 2.04523

## Задание 2

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих – 0.2

Рассмотрите два случая: для выборки sample_size1 \<- 100 и sample_size2 \<- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость. (3 балла)

```{r}
# создаем выборку со статусом курения (курит - 1, не курит - 0)
set.seed(51)
sample_size1 <-  100
is_smoking <- rep(c(1, 0), each = (sample_size1 / 2))
# генерируем выборки с наличием \ отсутствием рака для курящих
smoker_cancer <- rbinom((sample_size1 / 2), 1, 0.8)
non_smoker_cancer <- rbinom((sample_size1 / 2), 1, 0.2)
# объединяем обе выборки в датасет
cancer_data <-  c(smoker_cancer, non_smoker_cancer)
cancer_100 <-  data.frame(smoking_status = is_smoking, cancer_status = cancer_data)
head(cancer_100)

```

```{r}
# создадим сразу вторую выборку из 30 человек
set.seed(52)
sample_size2 <- 30
is_smoking <- rep(c(1,0), each = (sample_size2 / 2))
# генерируем выборки с наличием \ отсутствием рака для курящих
smoker_cancer <- rbinom((sample_size2 / 2), 1, 0.8)
non_smoker_cancer <- rbinom((sample_size2 / 2), 1, 0.2)
# объединяем обе выборки в датасет
cancer_data <-  c(smoker_cancer, non_smoker_cancer)
cancer_30 <-  data.frame(smoking_status = is_smoking, cancer_status = cancer_data)
head(cancer_30)
```

Итак нам необходимо проверить связь между курением и наличием рака легких (спойлер она должна быть)

```{r}
# установим уровень значимости
alpha = 0.05

# Сформулируем нулевую и альтернативную гипотезы
# H0 - нет связи между курением и возникновением рака легких
# H1 - есть связь между курением и возникновением рака легких

# Решил сделаь визуализацию наших датафреймов
cancer_100$smoking_status <- as.factor(cancer_100$smoking_status)
cancer_100$cancer_status <- as.factor(cancer_100$cancer_status)
ggplot(cancer_100, aes(x = smoking_status, fill = cancer_status)) +
  geom_bar(position = 'dodge')+
  labs(x = 'Статус курения', y = 'Частота', fill = 'Статус рака')+
  ggtitle('Статус курения по отношению к статусу наличия рака')
```

Для датафрейма из 30

```{r}
cancer_30$smoking_status <- as.factor(cancer_30$smoking_status)
cancer_30$cancer_status <- as.factor(cancer_30$cancer_status)
ggplot(cancer_30, aes(x = smoking_status, fill = cancer_status)) +
  geom_bar(position = 'dodge')+
  labs(x = 'Статус курения', y = 'Частота', fill = 'Статус рака')+
  ggtitle('Статус курения по отношению к статусу наличия рака')+
  scale_y_continuous(breaks = seq(0,30))
```

Итак, что мы имеем:

-   оба признака - категориальные

-   выборки независимы между собой

Можем использовать критерий Фишера

```{r}
# Создаем таблицу сопряженности
cont_table_100 <- table(cancer_100$smoking_status, cancer_100$cancer_status)

# Проводим тест Фишера
fisher_cancer_100 <- fisher.test(cont_table_100, alternative = 'greater')
fisher_cancer_100
```

Для выборки из 100 пациентов:

p-value = 1.066e-09

отношение шансов = 15.552

95% доверительный интервал: 6.334827 - бесконечность

```{r}
# Проводим тест для выборки из 30
# Создаем таблицу сопряженности
cont_table_30 <- table(cancer_30$smoking_status, cancer_30$cancer_status)

# Проводим тест Фишера
fisher_cancer_30 <- fisher.test(cont_table_30, alternative = 'greater')
fisher_cancer_30
```

Для выборки из 30 пациентов:

p-value = 0.01047

отношение шансов = 8.93874

95% интервал: 1.639288 - бесконечность

Таким образом: в обоих случаях p value меньше 0.05 -\> мы отклоняем нулевую гипотезу и принимаем альтернативную "есть связь между курением и возникновением рака легких". Отношение шансов в тестах говорит о том, что наступление рака при курении более вероятно в 15.5 и 9 раз в выборках из 100 и 30 человек.

## Задание 3

**Рассмотрите следующую статистическую гипотезу.**

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией. (исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение)

-   Сформулируйте нулевую и альтернативную гипотезы.

-   Определите уровень значимости.

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

-   Оцените и прокомментируйте статистическую значимость. (3 балла)

```{r}
sample_size <- 30

# Генерируем выборки
set.seed(13)
new_treatment <- round(rnorm(sample_size, 4, 2))

set.seed(50)
diet_treatment <- round(rnorm(sample_size, 7, 3))

# формируем датасет
treatment_data <- data.frame(new_method = new_treatment, diet_therapy = diet_treatment)
head(treatment_data)
```

Сформулируем гипотезы:

H0 - нет значимой стат разницы в уровне боли между двумя методами лечения

H1 - есть значимая стат разница между двумя методами

```{r}
# уровень значимости
alpha = 0.05

# Визуально оценим распределение в обоих методах
ggplot(treatment_data, aes(x = new_method)) +
  geom_histogram(binwidth = 2,fill = "lightblue", color = "black") +
  labs(title = "Гистограмма распределения уровня боли у пациентов на новом методе", x = "Новый метод", y = "Частота") +
  theme_minimal()
```

```{r}
ggplot(treatment_data, aes(x = diet_therapy)) +
  geom_histogram(binwidth = 2,fill = "pink", color = "black") +
  labs(title = "Гистограмма распределения уровня боли у пациентов на диетотерапие", x = "Новый метод", y = "Частота") +
  theme_minimal()
```

```{r}
# Проведем тесты на нормальность
shapiro.test(treatment_data$new_method)
shapiro.test(treatment_data$diet_therapy)
```

Можем сделать заключение, что распредление в обоих выборках одинаковое, нормальное.

Таким образом:

-   у нас количественные данные

-   данные распределены нормально

-   выборки зависимы

Мы можем использовать T тест для независимых выборок (не парный)

```{r}
# результаты теста
t.test(treatment_data$new_method, treatment_data$diet_therapy)

# критическое значение
qt(1 - alpha/2, df = 58)
```

P value = 2.92e -05 \< 0.05 -\> Принимаем альтернативную гипотезу "есть значимая стат разница между двумя методами".

Критическое значение равно 2.001717

Средний уровень боли у группы с новым методом 4, а у группы на диетотерапии 6.9 - можем сделать вывод, что метод эффективен.
